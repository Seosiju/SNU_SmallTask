# Task(3) 그림 기반 이야기 생성기

## 📖 프로젝트 개요

이 프로젝트는 여러 이미지를 분석하여 AI가 자동으로 이야기 테마를 제안하고, 사용자가 선택한 테마에 따라 완성된 이야기를 생성하는 시스템입니다. OpenAI의 GPT-4 Vision API를 활용하여 이미지 캡션을 생성하고, 이를 바탕으로 감정적이고 일관성 있는 스토리를 만들어냅니다.

## 🎯 주요 기능

### 1. 이미지 분석

- **GPT-4 Vision API**를 사용하여 이미지를 한국어로 자연스럽게 묘사
- 폴더 내 모든 이미지 파일을 자동으로 스캔하여 순차적으로 분석
- 지원 형식: `.png`, `.jpg`, `.jpeg`

### 2. 스토리 테마 제안

- 이미지 캡션을 바탕으로 3가지 이야기 테마를 AI가 자동 제안
- 각 테마는 **감정**과 **한 줄 요약**으로 구성
- 정규표현식을 사용한 자동 파싱으로 구조화된 데이터 추출

### 3. 인터랙티브 테마 선택

- 사용자가 원하는 분위기를 자유롭게 입력 가능
- **자카드 유사도** 알고리즘을 사용한 텍스트 매칭
- 번호 입력 또는 키워드 입력 모두 지원

### 4. 스토리 생성

- 선택된 테마와 이미지 순서를 반영한 완성된 이야기 생성
- 3인칭 관찰자 시점, 현재 시제 사용
- 각 이미지에 해당하는 장면을 1-2문장으로 간결하게 구성

## 🛠️ 기술 스택

- **Python 3.13.5**
- **OpenAI API** (GPT-4o-mini)
- **Jupyter Notebook**
- **Base64** 이미지 인코딩
- **정규표현식** 텍스트 파싱
- **자카드 유사도** 알고리즘

## 📁 프로젝트 구조

```
task3/
├── task(3).ipynb          # 메인 노트북 파일
├── images/                # 이미지 폴더
│   ├── 01.jpg
│   ├── 02.jpg
│   └── 03.jpeg
└── readme_task3.md        # 이 파일
```

## ⚙️ 설정 및 설치

### 1. 환경 설정

```python
# .env 파일에 OpenAI API 키 설정
OPENAI_API_KEY=your_api_key_here
```

### 2. 필요한 패키지 설치

```bash
pip install openai python-dotenv
```

### 3. 노트북 설정

```python
# ============ 설정 ============
FOLDER = "/path/to/your/images"    # 이미지 폴더 경로
INTERACTIVE = True                 # 대화형 모드 활성화
USE_OPENAI = True                  # OpenAI API 사용
SAVE_TXT = False                   # TXT 파일 저장
SAVE_JSON = False                  # JSON 파일 저장
RANDOM_SEED = 42                   # 재현성을 위한 시드
```

## 🚀 사용 방법

### 1. 이미지 준비

- `images/` 폴더에 이야기로 만들고 싶은 이미지들을 순서대로 배치
- 지원 형식: `.png`, `.jpg`, `.jpeg`

### 2. 노트북 실행

1. 첫 번째 셀에서 설정값 확인 및 수정
2. 두 번째 셀에서 라이브러리 로드 및 OpenAI 클라이언트 초기화
3. 나머지 셀들을 순차적으로 실행

### 3. 테마 선택

- AI가 제안한 3가지 테마 중 선택
- 번호 입력 (1, 2, 3) 또는 키워드 입력 ("기쁨", "우정" 등)

### 4. 결과 확인

- 생성된 이야기를 콘솔에서 확인
- 필요시 TXT 또는 JSON 파일로 저장

## 📊 실행 예시

### 입력 이미지

- 인형방의 다양한 장난감들
- 선반 위의 장난감들
- 카우보이와 우주복을 입은 캐릭터들

### AI 제안 테마

1. **기쁨**: 다양한 장난감들이 함께 모여 서로의 모험을 응원하며 화기애애한 분위기
2. **호기심**: 서로 다른 배경을 가진 캐릭터들이 힘을 합쳐 새로운 모험을 준비
3. **우정**: 카우보이와 우주복을 입은 두 친구가 서로 다른 세계에서 온 특별한 우정

### 생성된 이야기

```
인형방의 한가운데, 다양한 장난감들이 모여 서로의 모험을 응원하며 화기애애한 분위기를 만들어간다. 
각기 다른 모습과 색깔로 장식된 인형들은 서로의 존재를 반기며 기쁨으로 가득 차 있다. 
선반 위에는 각양각색의 장난감들이 나란히 서 있다. 그들은 사이좋게 지켜보며, 이제 시작될 모험을 위해 준비하는 모습이다...
```

## 🔧 주요 클래스 및 함수

### `ImageAnalyzer`

- 이미지를 Base64로 인코딩
- GPT-4 Vision API를 통한 이미지 분석
- 폴더 내 모든 이미지 일괄 처리

### `StoryGenerator`

- 이미지 캡션을 바탕으로 스토리 테마 제안
- 선택된 테마로 최종 이야기 생성
- 정규표현식을 사용한 응답 파싱

### `jaccard_similarity()`

- 사용자 입력과 테마 간의 유사도 계산
- 자유 텍스트 입력을 통한 테마 매칭

## 📝 출력 형식

### 콘솔 출력

- 이미지 캡션 목록
- 제안된 테마 목록
- 최종 생성된 이야기

### 파일 저장 (선택사항)

- **TXT**: 순수 텍스트 형태의 이야기
- **JSON**: 캡션, 선택된 테마, 생성된 이야기, 모든 제안 테마 포함

## 🎨 커스터마이징

### 프롬프트 수정

```python
# 이미지 분석 프롬프트
self.prompt_style = "이 이미지를 보고, 한국어로 1~2문장으로 자연스럽게 묘사해줘."

# 스토리 생성 프롬프트
# StoryGenerator.generate_story() 메서드 내부에서 수정 가능
```

### 설정 변경

- `INTERACTIVE`: 대화형 모드 on/off
- `SAVE_TXT`, `SAVE_JSON`: 결과 저장 옵션
- `RANDOM_SEED`: 재현성을 위한 시드값

## ⚠️ 주의사항

1. **API 키 설정**: `.env` 파일에 유효한 OpenAI API 키가 필요합니다.
2. **이미지 크기**: 너무 큰 이미지는 처리 시간이 오래 걸릴 수 있습니다.
3. **API 비용**: GPT-4 Vision API 사용 시 비용이 발생합니다.
4. **이미지 순서**: 폴더 내 이미지 파일명 순서대로 이야기가 구성됩니다.

## 🔮 향후 개선 사항

- [ ] 이미지 순서 사용자 지정 기능
- [ ] 다양한 스토리 스타일 옵션
- [ ] 이미지 품질 자동 최적화
- [ ] 다국어 지원
- [ ] 웹 인터페이스 개발
