# μ‹¤μµ 9: μΉ΄ν Kiosk μμ—°μ–΄ μΈν„°νμ΄μ¤ (RAG)

## π“‹ κ°μ”

μ΄ μ‹¤μµμ€ RAG(Retrieval-Augmented Generation) κΈ°μ μ„ ν™μ©ν•μ—¬ μΉ΄ν ν‚¤μ¤μ¤ν¬μ© μμ—°μ–΄ μΈν„°νμ΄μ¤λ¥Ό κµ¬ν„ν•λ” ν”„λ΅μ νΈμ…λ‹λ‹¤. ν”„λ΅ νΈμ—”λ“ μ—†μ΄ μ§μ λ¦¬μ¤νΈλ¥Ό μ…λ ¥ν•λ©΄ κ²°κ³Ό λ¦¬ν¬νΈλ¥Ό μƒμ„±ν•λ” μ‹μ¤ν…μ„ κµ¬μ¶•ν•©λ‹λ‹¤.

## π― μ£Όμ” κΈ°λ¥

- **λ©”λ‰΄ λ°μ΄ν„° κ΄€λ¦¬**: μλ£, λ””μ €νΈ, μµμ… μ •λ³΄λ¥Ό JSON ν•νƒλ΅ κ΄€λ¦¬
- **λ²΅ν„° κ²€μƒ‰**: multilingual-e5-base λ¨λΈμ„ μ‚¬μ©ν• μλ―Έ κΈ°λ° κ²€μƒ‰
- **μΈν…νΈ λ¶„λ¥**: μ •κ·μ‹ κΈ°λ° μλ„ λ¶„λ¥ (μ£Όλ¬Έ, μµμ…, μ¶”μ², λ³µν•© μ§μ λ“±)
- **μ¥λ°”κµ¬λ‹ κ΄€λ¦¬**: μ£Όλ¬Έ ν•­λ© μ¶”κ°€, μµμ… μ μ©, κ°€κ²© κ³„μ‚°
- **LLM ν†µν•©**: OpenAI APIλ¥Ό ν™μ©ν• μμ—°μ¤λ¬μ΄ μ‘λ‹µ μƒμ„±
- **λ€ν™”ν• μΈν„°νμ΄μ¤**: μ‹¤μ‹κ°„ μ±„ν… ν•νƒμ ν‚¤μ¤μ¤ν¬ μ‹μ—°

## π› οΈ κΈ°μ  μ¤νƒ

- **μ„λ² λ”© λ¨λΈ**: `intfloat/multilingual-e5-base`
- **λ²΅ν„° λ°μ΄ν„°λ² μ΄μ¤**: FAISS
- **LLM**: OpenAI GPT-4o-mini
- **ν”„λ μ„μ›ν¬**: LangChain, Sentence Transformers
- **λ°μ΄ν„° μ²λ¦¬**: Pandas, JSON

## π“ νμΌ κµ¬μ΅°

```
task(9)/
β”β”€β”€ task(9).ipynb          # λ©”μΈ μ‹¤μµ λ…ΈνΈλ¶
β”β”€β”€ task(9)_presentation.pdf  # λ°ν‘ μλ£
β””β”€β”€ README.md              # μ΄ νμΌ
```

## π€ μ‹¤ν–‰ λ°©λ²•

### 1. ν™κ²½ μ„¤μ •

```bash
pip install sentence-transformers faiss-cpu langchain langchain-openai python-dotenv
```

### 2. μ‹¤ν–‰ μμ„

1. **λ°μ΄ν„° μƒμ„±**: λ©”λ‰΄ λ°μ΄ν„°λ¥Ό JSON νμΌλ΅ μƒμ„±
2. **μΈλ±μ¤ κµ¬μ¶•**: λ²΅ν„° μ„λ² λ”© λ° FAISS μΈλ±μ¤ μƒμ„±
3. **λ΅μ§ λ΅λ”©**: μ±—λ΄‡ ν•µμ‹¬ λ΅μ§ κµ¬ν„
4. **λ°°μΉ λ¦¬ν¬νΈ**: μ§μ λ¦¬μ¤νΈ μλ™ μ²λ¦¬
5. **μ‹μ—°**: λ€ν™”ν• μΈν„°νμ΄μ¤ ν…μ¤νΈ

## π“ λ©”λ‰΄ λ°μ΄ν„° κµ¬μ΅°

### μλ£ (Drinks)
- 11μΆ…μ μ»¤ν”Ό/λ…Όμ»¤ν”Ό μλ£
- 3κ°€μ§€ μ‚¬μ΄μ¦ (S, M, L)
- κ°€κ²©, μ„¤λ…, νμ–΄λ§, νƒκ·Έ μ •λ³΄ ν¬ν•¨

### λ””μ €νΈ (Desserts)
- 8μΆ…μ λ””μ €νΈ
- κ°€κ²© λ° μ„¤λ… μ •λ³΄

### μµμ… (Options)
- μƒ· μ¶”κ°€, μ‹λ½, μ°μ  λ³€κ²½, νν•‘ λ“±
- μ μ© κ°€λ¥ν• λ©”λ‰΄ νƒ€μ…λ³„ λ¶„λ¥

## π” μΈν…νΈ λ¶„λ¥

| μΈν…νΈ | ν¨ν„΄ | μ„¤λ… |
|--------|------|------|
| `order` | "μ£Όμ„Έμ”", "μ£Όλ¬Έ", "μ‚΄κ²μ”" | λ©”λ‰΄ μ£Όλ¬Έ |
| `option` | "μ¶”κ°€", "λ³€κ²½", "μ°μ ", "μƒ·" | μµμ… κ΄€λ ¨ |
| `recommend` | "μ¶”μ²", "λ‹¬μ½¤", "μΈκΈ°" | μ¶”μ² μ”μ²­ |
| `complex` | "κ·Έλ¦¬κ³ ", "λΉ„κµ", "μ¤‘μ— λ­κ°€" | λ³µν•© μ§μ |
| `menu_info` | "κ°€κ²©", "μ–Όλ§", "μ„¤λ…" | λ©”λ‰΄ μ •λ³΄ |
| `cart_summary` | "μ¥λ°”κµ¬λ‹" | μ¥λ°”κµ¬λ‹ μ΅°ν |

## π’΅ ν•µμ‹¬ κµ¬ν„ μ‚¬ν•­

### 1. λ²΅ν„° κ²€μƒ‰ μ‹μ¤ν…
```python
def retrieve(q, topk=4):
    qv = emb_model.encode([q], normalize_embeddings=True, convert_to_numpy=True)
    D, I = index.search(qv, topk)
    return [{"text": store["chunks"][i], "meta": store["meta"][i], "score": float(D[0][j])} for j, i in enumerate(I[0])]
```

### 2. μ¥λ°”κµ¬λ‹ κ΄€λ¦¬
```python
@dataclass
class CartItem:
    item_id: str
    name: str
    kind: str
    size: str | None
    base_price: int
    qty: int = 1
    options: List[Dict] = field(default_factory=list)
```

### 3. LLM ν†µν•© μ‘λ‹µ μƒμ„±
- OpenAI APIλ¥Ό ν†µν• μμ—°μ¤λ¬μ΄ μ‘λ‹µ μƒμ„±
- μλ„λ³„ ν”„λ΅¬ν”„νΈ ν…ν”λ¦Ώ ν™μ©
- LLM μ‹¤ν¨ μ‹ κ·μΉ™ κΈ°λ° Fallback μ‹μ¤ν…

## π§ ν…μ¤νΈ μΌ€μ΄μ¤

### λ°°μΉ ν…μ¤νΈ
- λ©”λ‰΄ μ •λ³΄ μ΅°ν
- μ¶”μ² μ”μ²­
- μ£Όλ¬Έ μ²λ¦¬
- μµμ… λ¬Έμ
- λ³µν•© μ§μ
- λ¬΄κ΄€ν• μ§λ¬Έ μ²λ¦¬

### λ€ν™”ν• ν…μ¤νΈ
- μ‹¤μ‹κ°„ μ±„ν… μΈν„°νμ΄μ¤
- λ€ν™” νμ¤ν† λ¦¬ κ΄€λ¦¬
- μμ—°μ¤λ¬μ΄ μ‘λ‹µ μƒμ„±

## π“ μ„±λ¥ νΉμ§•

- **λΉ λ¥Έ κ²€μƒ‰**: FAISS μΈλ±μ¤λ¥Ό ν†µν• κ³ μ† λ²΅ν„° κ²€μƒ‰
- **μ •ν™•ν• λ¶„λ¥**: μ •κ·μ‹ κΈ°λ° μΈν…νΈ λ¶„λ¥
- **μ μ—°ν• μ‘λ‹µ**: LLM + κ·μΉ™ κΈ°λ° ν•μ΄λΈλ¦¬λ“ μ‹μ¤ν…
- **λ‹¤κµ­μ–΄ μ§€μ›**: multilingual-e5-base λ¨λΈ ν™μ©

## π”§ μ„¤μ • λ° μ»¤μ¤ν„°λ§μ΄μ§•

### ν™κ²½ λ³€μ
```bash
OPENAI_API_KEY=your_api_key_here
```

### λ©”λ‰΄ λ°μ΄ν„° μμ •
`menu.json` νμΌμ„ μμ •ν•μ—¬ λ©”λ‰΄ μ •λ³΄λ¥Ό μ—…λ°μ΄νΈν•  μ μμµλ‹λ‹¤.

### μΈν…νΈ ν¨ν„΄ μμ •
`INTENT_PATTERNS` λ”•μ…”λ„λ¦¬λ¥Ό μμ •ν•μ—¬ μƒλ΅μ΄ μλ„ ν¨ν„΄μ„ μ¶”κ°€ν•  μ μμµλ‹λ‹¤.

## π“ μ‚¬μ© μμ‹

```python
# κΈ°λ³Έ μ‚¬μ©λ²•
cart = OrderManager(menu)
intent, response = answer("μ•„λ©”λ¦¬μΉ΄λ…Έ M μ‚¬μ΄μ¦ μ£Όλ¬Έν•΄μ£Όμ„Έμ”", cart)
print(response)

# μ¥λ°”κµ¬λ‹ ν™•μΈ
print(cart.summary())
```

## π― ν•™μµ λ©ν‘

1. **RAG μ‹μ¤ν… κµ¬ν„**: κ²€μƒ‰κ³Ό μƒμ„±μ κ²°ν•©
2. **μΈν…νΈ λ¶„λ¥**: μμ—°μ–΄ μ²λ¦¬μ κΈ°λ³Έ
3. **λ²΅ν„° κ²€μƒ‰**: μλ―Έ κΈ°λ° μ •λ³΄ κ²€μƒ‰
4. **λ€ν™” μ‹μ¤ν…**: μƒνƒ κ΄€λ¦¬μ™€ λ§¥λ½ μ μ§€
5. **μ‹¤μ©μ  AI**: μ‹¤μ  μ„λΉ„μ¤μ— μ μ© κ°€λ¥ν• μ‹μ¤ν…

## π“ μ°Έκ³  μλ£

- [Sentence Transformers](https://www.sbert.net/)
- [FAISS Documentation](https://faiss.ai/)
- [LangChain Documentation](https://python.langchain.com/)
- [OpenAI API Documentation](https://platform.openai.com/docs)

---

**μ‹¤μµ μ™„λ£ ν›„**: μ΄ μ‹μ¤ν…μ„ κΈ°λ°μΌλ΅ μ‹¤μ  μΉ΄ν ν‚¤μ¤μ¤ν¬λ‚ μ¨λΌμΈ μ£Όλ¬Έ μ‹μ¤ν…μ— μ μ©ν•  μ μμµλ‹λ‹¤.
