# Task(10) AI Report Automation Chatbot

## 📋 프로젝트 개요

OpenAI API와 웹 검색 기능을 활용하여 사용자가 입력한 주제에 대해 자동으로 구조화된 리포트를 생성하는 대화형 챗봇 시스템입니다.

### 주요 기능
- **주제 명확성 판단**: 입력된 주제가 구체적인지 모호한지 자동 판단
- **Clarify 단계**: 모호한 주제에 대한 추가 질문으로 구체화 유도
- **웹 검색 기반 리포트**: 신뢰할 만한 출처를 통한 최신 정보 수집
- **구조화된 리포트**: Keywords, Sources, Summary, Body 4개 섹션으로 구성

### 기술 스택
- **OpenAI API**: gpt-4o (대화 처리), gpt-4o-search-preview (웹 검색)
- **Python**: 주요 프로그래밍 언어
- **python-dotenv**: 환경 변수 관리

## 🚀 설치 및 설정

### 1. 필수 패키지 설치

```bash
pip install openai python-dotenv
```

### 2. 환경 변수 설정

`.env` 파일을 생성하고 OpenAI API 키를 설정:

```env
OPENAI_API_KEY=your_openai_api_key_here
```

### 3. 실행 방법

Jupyter Notebook에서 `task(10).ipynb` 파일을 열고 셀을 순차적으로 실행하세요.

## 💻 사용 방법

### 기본 사용법

```python
# 안전한 대화 모드 시작
chat_loop_safe()

# 종합 테스트 실행
run_comprehensive_test()

# 간단한 대화 테스트
test_chat()
```

### 대화 흐름

1. **사용자 입력**: 궁금한 주제를 입력
2. **명확성 판단**: 주제가 구체적인지 모호한지 자동 판단
3. **분기 처리**:
   - **모호한 주제**: Clarify 질문으로 구체화 유도
   - **명확한 주제**: 웹 검색을 통한 리포트 생성
4. **결과 출력**: 구조화된 리포트 또는 추가 질문 제공

## 📊 리포트 구조

생성되는 리포트는 다음 4개 섹션으로 구성됩니다:

### 1. Keywords
- 실제 사용한 주요 검색어 목록 (5-8개)
- 웹 검색에 사용된 핵심 키워드들

### 2. Sources
- 신뢰할 만한 웹사이트 URL 목록 (3-5개)
- 정부기관, 학술기관, 언론사 등 신뢰할 만한 출처 우선

### 3. Summary
- 핵심 내용의 압축 서술 (5-7문장)
- 리포트의 주요 내용을 간결하게 요약

### 4. Body
- 서론-본론-결론 구조의 분석 리포트 (1000-1500자)
- 구체적인 데이터와 사례를 포함한 상세 분석

## 🔧 주요 함수

### 핵심 함수들

- `is_topic_vague(topic)`: 주제의 명확성 판단
- `clarify_question(topic, attempt)`: 모호한 주제에 대한 추가 질문 생성
- `generate_report(topic)`: 웹 검색을 통한 리포트 생성
- `format_report(report, topic)`: 리포트 포맷팅
- `chat_loop_safe()`: 안전한 대화 루프

### 에러 처리 함수들

- `handle_api_error(error)`: API 오류 처리
- `validate_topic(topic)`: 주제 유효성 검증
- `safe_generate_report(topic)`: 안전한 리포트 생성
- `process_user_input_safe(user_input)`: 안전한 입력 처리

### 테스트 함수들

- `run_comprehensive_test()`: 종합 테스트 실행
- `test_specific_scenarios()`: 특정 시나리오 테스트
- `test_chat()`: 간단한 대화 테스트

## 🧪 테스트 케이스

### 모호한 주제 테스트
- "AI", "경제", "환경", "기술" 등
- 예상 결과: Clarify 질문 생성

### 명확한 주제 테스트
- "AI가 교육에 미치는 영향"
- "2024년 한국 부동산 시장 전망"
- "코로나19가 온라인 쇼핑에 미친 영향"
- 예상 결과: 구조화된 리포트 생성

### 경계선 케이스 테스트
- 빈 입력, 너무 짧은 입력, 너무 긴 입력
- 예상 결과: 입력 검증 오류 메시지

## 📋 평가 기준

이 프로젝트는 다음 5가지 기준으로 평가됩니다:

1. **🎯 Design Requirements 충족**: 명확한 Clarify/Research 분기 및 리포트 구성
2. **🧭 흐름 제어 정확도**: 사용자 입력에 따른 자연스러운 진행
3. **🔍 신뢰성**: 실제 검색 기반 리포트인지 여부
4. **🧩 코드 완성도**: 기능적 일관성, 에러 처리 포함 여부
5. **💬 UX 자연스러움**: 대화 맥락이 인간스럽고 매끄러운가

## 🔍 사용 예시

### 예시 1: 모호한 주제
```
사용자: AI
챗봇: AI에 대해 어떤 분야가 궁금하신가요? 교육, 의료, 자율주행, 창작 중에서 선택해주세요.
```

### 예시 2: 명확한 주제
```
사용자: AI가 교육에 미치는 영향
챗봇: # Report: AI가 교육에 미치는 영향
## 1. Keywords
AI, 교육, 머신러닝, 개인화 학습, 온라인 교육
## 2. Sources
- https://www.ed.gov/
- https://www.nature.com/
...
```

### 예시 3: 잘못된 입력
```
사용자: 
챗봇: ❌ 주제를 입력해주세요.
```

## ⚙️ 설정 옵션

### 전역 설정
```python
MAX_CLARIFY_ATTEMPTS = 2      # 최대 Clarify 시도 횟수
MAX_HISTORY_LENGTH = 20       # 대화 히스토리 최대 길이
```

### 모델 설정
- **대화 처리**: gpt-4o
- **웹 검색**: gpt-4o-search-preview
- **온도 설정**: 0.3 (일관성), 0.7 (창의성)

## 🛡️ 에러 처리

### API 오류 처리
- Rate limit 초과: "API 사용량이 초과되었습니다. 잠시 후 다시 시도해주세요."
- 인증 오류: "API 인증에 문제가 있습니다. API 키를 확인해주세요."
- 네트워크 오류: "네트워크 연결에 문제가 있습니다. 인터넷 연결을 확인해주세요."

### 입력 검증
- 빈 입력: "주제를 입력해주세요."
- 너무 짧은 입력: "주제가 너무 짧습니다. 더 구체적으로 입력해주세요."
- 너무 긴 입력: "주제가 너무 깁니다. 500자 이내로 입력해주세요."

## 📈 성능 특징

- **빠른 응답**: 효율적인 API 호출 및 캐싱
- **정확한 분류**: GPT-4o 기반 주제 명확성 판단
- **신뢰할 만한 검색**: gpt-4o-search-preview를 통한 최신 정보 수집
- **견고한 에러 처리**: 다양한 예외 상황에 대한 안전한 처리
- **사용자 친화적**: 직관적인 대화 인터페이스

## 🔄 시스템 아키텍처

```
사용자 입력 → 입력 검증 → 주제 명확성 판단
     ↓              ↓           ↓
  유효성 확인    길이/형식 검사   GPT-4o 판단
     ↓              ↓           ↓
  오류 메시지    재입력 요청   Clarify vs Research
     ↓              ↓           ↓
  종료/재시도    사용자 피드백   질문 생성 vs 리포트 생성
     ↓              ↓           ↓
  대화 종료      대화 계속     최종 응답 출력
```

## 📝 주의사항

1. **API 키 보안**: `.env` 파일을 `.gitignore`에 추가하여 버전 관리에서 제외
2. **API 사용량**: OpenAI API 사용량에 따른 비용 발생 가능
3. **네트워크 연결**: 웹 검색 기능 사용 시 안정적인 인터넷 연결 필요
4. **응답 시간**: 웹 검색 및 리포트 생성에 시간이 소요될 수 있음

## 🚧 향후 개선 사항

- [ ] 다국어 지원 (영어, 일본어 등)
- [ ] 리포트 저장 및 히스토리 관리
- [ ] 사용자 맞춤형 리포트 스타일
- [ ] 실시간 검색 결과 업데이트
- [ ] 음성 입력/출력 지원
- [ ] 웹 인터페이스 개발

## 📚 참고 자료

- [OpenAI API Documentation](https://platform.openai.com/docs)
- [python-dotenv Documentation](https://python-dotenv.readthedocs.io/)
- [Cursor Rules for AI Report Automation](/.cursor/rules/rules.mdc)

---

**💬 문의사항이나 개선 제안이 있으시면 언제든 연락해주세요!**
